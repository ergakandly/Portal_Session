<!DOCTYPE sqlMap
PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="employees">

<!-- ASSIGN ROLE	 -->
	<select id="getEmployee" resultClass="com.hris.portal.model.PortalBean" parameterClass="java.util.Map">
		SELECT
			e.employee_id AS employeeId,
			e.employee_name AS employeeName,
			d.department_name AS departmentName,
			l.location_name AS locationName,
   	 		u.employee_id AS userEmployeeId
		FROM
			ms_employee e
			left outer join ms_department d 
            on d.department_id = e.department_id
            left outer join ms_location l 
            on l.location_id = d.location_id
            left outer join ms_user u
    		on u.employee_id = e.employee_id
		WHERE 1=1
		<dynamic prepend="AND">
			<isNotEmpty property = "departmentId" >
				d.department_id = #departmentId#
			</isNotEmpty>
		</dynamic> 
		<dynamic prepend="AND">
			<isNotEmpty property = "searchName">
<!-- 				lower(e.employee_name) = lower(#searchName#) -->
				lower(e.employee_name) like '%'||lower(#searchName#)||'%'
			</isNotEmpty>
		</dynamic> 

			ORDER BY 
				e.employee_id
	</select>

	<select id = "getDepartmentName" resultClass="com.hris.portal.model.PortalDepartmentBean" parameterClass="java.lang.String">
		SELECT
			d.department_id AS departmentId,
		    d.department_name || ' - ' || l.location_name AS msDepartmentName,
		    d.location_id AS locationId
		FROM
		    ms_department d
		    join ms_location l
		    on l.location_id = d.location_id
		order by
		    department_id
	</select>
	
	<select id = "getOneEmp" resultClass="com.hris.portal.model.PortalDepartmentBean" parameterClass="java.lang.String">
		
		SELECT
<!-- 		    e.employee_id AS employeeId, -->
			e.employee_name AS deptEmployeeName,
		    e.department_id AS departmentId,
		    d.department_name AS msDepartmentName,
		    d.location_id AS locationId
		FROM
		    ms_employee e
		    join ms_department d
		    on d.department_id = e.department_id
		WHERE
			e.employee_id = #empId# 
	</select>

	<select id = "getRoleList" resultClass="com.hris.portal.model.PortalBean" parameterClass="java.lang.String">
		SELECT
		    e.employee_name AS employeeName,
		    r.role_name AS roleName
		FROM
		    ms_employee e
		    join ms_user u 
		    on u.employee_id = e.employee_id
		    join ms_role r 
		    on u.role_id = r.role_id
		ORDER BY 
		    e.employee_id	
	</select>
	
	<select id = "getRoleName" resultClass="com.hris.portal.model.PortalBean" parameterClass="java.lang.String">
		SELECT
			role_id AS roleId,
		    role_name AS roleName
		FROM
		    ms_role
	</select>
	
	<select id = "getUserList" resultClass="com.hris.portal.model.PortalUserBean" parameterClass="java.lang.String">
	SELECT
		username AS userName,
	    password AS password,
	    role_id AS  userRoleId,
	    e.employee_id AS userEmployeeId
	FROM
	    ms_user
	    left outer join ms_user u
	    on u.employee_id = e.employee_id
	</select>
	
	<insert id = "insertUser" parameterClass="java.util.Map">
		INSERT INTO
			MS_USER
		VALUES
			((SELECT MAX(user_id) AS MAX_ID FROM MS_USER)+1, #employeeName#, #msDepartmentName#, #empId#, #roleId#, null, SYSDATE, null, null)
	</insert>



<!-- MASTER ROLE -->
	<select id = "getMasterRoleName" resultClass="com.hris.portal.model.PortalMasterRoleBean" parameterClass="java.lang.String">
		SELECT
			role_id AS roleId,
			role_name AS roleName
		FROM
		    ms_role
		order by
		    role_id
	</select>

<!-- Menu Role -->
	<select id = "getMenuRoleName" resultClass="com.hris.portal.model.PortalMasterRoleBean" parameterClass="java.lang.String">
		SELECT
			m.menu_id AS menuId,
		    m.menu AS menuName
		FROM
		    ms_role r
		    left outer join tr_role_menu trm
		    on trm.role_id = r.role_id
		    left outer join ms_menu m
		    on trm.menu_id = m.menu_id
		WHERE
		    r.role_id=#roleId#
		order by
		    r.role_id
	</select>
	
<!-- 	Privilage Role -->
	<select id = "getPrivRoleName" resultClass="com.hris.portal.model.PortalMasterRoleBean" parameterClass="java.lang.String">
		SELECT
		    p.privilege_id AS privilegeId,
		    p.privilege AS privilegeName
		FROM
		    ms_role r
		    left outer join tr_role_privilege trp
		    on trp.role_id = r.role_id 
		    left outer join ms_privilege p
		    on trp.privilege_id = p.privilege_id
		WHERE
		    r.role_id=#roleId#
		ORDER BY
		    r.role_id
	</select>
	
<!-- 	MENU VIEW -->
	<select id = "getMasterMenuName" resultClass="com.hris.portal.model.PortalMasterRoleBean" parameterClass="java.lang.String">
		SELECT
		    menu_id AS menuIdView,
		    menu AS menuNameView
		FROM
		    ms_menu
		order by
		    menu_id
	</select>
	
<!-- 	PRIVILAGE VIEW -->
	<select id = "getMasterPrivilegeName" resultClass="com.hris.portal.model.PortalMasterRoleBean" parameterClass="java.lang.String">
		SELECT
		    privilege_id AS privilegeIdView,
		    privilege AS privilegeNameView
		FROM
		    ms_privilege
		order by
		    privilege_id
	</select>

<!-- 	INSERT NEW ROLE Name-->
	<insert id = "insertNewRoleName" parameterClass="java.lang.String">
		INSERT INTO
		    ms_role
		VALUES
		    (ms_role_seq.nextval, #addRoleName#, '',sysdate,'','')
	</insert>

<!-- 	INSERT NEW ROLE TR_MENU-->
	<insert id = "insertNewRoleMenu" parameterClass="java.lang.String">
		INSERT INTO
		    tr_role_menu
		VALUES
		    (tr_role_menu_seq.nextval, ms_role_seq.currval, #insertRoleMenuId#)
	</insert>
	
<!-- 	INSERT NEW ROLE -->
	<insert id = "insertNewRolePriv" parameterClass="java.lang.String">
		INSERT INTO
		    tr_role_privilege
		VALUES
		    (tr_role_privilege_seq.nextval, ms_role_seq.currval, #insertRolePrivId#)
	</insert>

</sqlMap>