<!DOCTYPE sqlMap
PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="users">
	<select id = "checkLogin" resultClass="com.hris.portal.model.PortalUserBean" parameterClass="java.util.Map">
		SELECT
			role_id			AS userRoleId,
			user_id 		AS userId,
			username		AS userName,
			password		AS password,
			employee_name	AS employeeName
		FROM
		    ms_user users
		JOIN
			ms_employee emp
		ON
			users.employee_id = emp.employee_id
		WHERE
			lower(username) = lower(#username#) AND password = #password#
	</select>
	
<!-- AUTHORIZED USER -->
	<select id="isAuthorized" parameterClass="java.util.Map" resultClass="int">
		SELECT
			1
		FROM
			ms_user users
		JOIN
			ms_employee emp
		ON
			users.employee_id = emp.employee_id
		WHERE
			username = #username#
			AND
			password = #password#
			AND
			is_login = '0'
			AND
			status = '1'
	</select>
	
<!-- UPDATE STATUS LOGIN -->
	<update id="updateStatusLogin" parameterClass="java.util.Map">
		UPDATE
			ms_user
		SET
			is_login = #status#
		WHERE
			username = #username#
	</update>

<!-- RESET STATUS LOGIN -->
	<update id="resetStatusLogin">
		UPDATE
			ms_user
		SET
			is_login = '0',
			update_date = SYSDATE
		WHERE
			is_login = '1'
	</update>	
</sqlMap>