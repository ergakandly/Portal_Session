<!DOCTYPE sqlMap
PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="employees">

<!-- 	<select id="getEmployee" resultClass="com.hris.portal.model.PortalBean"> -->
<!-- 		SELECT -->
<!-- 		employee_id AS employeeId, -->
<!-- 		first_name AS employeeFName, -->
<!-- 		last_name AS employeeLName -->
<!-- 		FROM -->
<!-- 		emp_coba -->
<!-- 	</select> -->

<!-- 	<select id="getEmployee" resultClass="com.hris.portal.model.PortalBean"> -->
<!-- 		SELECT -->
<!-- 		employee_id AS employeeId, -->
<!-- 		employee_name AS employeeName -->
<!-- 		FROM -->
<!-- 		ms_employee -->
<!-- 	</select> -->
	
	<select id="getEmployee" resultClass="com.hris.portal.model.PortalBean" parameterClass="java.util.Map">
		SELECT
			e.employee_id AS employeeId,
			e.employee_name AS employeeName,
			d.department_name AS departmentName,
			l.location_name AS locationName
		FROM
			ms_employee e
			left outer join ms_department d 
            on d.department_id = e.department_id
            left outer join ms_location l 
            on l.location_id = d.department_id
		WHERE 1=1
		<dynamic prepend="AND">
			<isNotEmpty property = "departmentId" >
				d.department_id = #departmentId#
			</isNotEmpty>
		</dynamic> 
		<dynamic prepend="AND">
			<isNotEmpty property = "searchName">
<!-- 				lower(e.employee_name) = lower(#searchName#) -->
				lower(e.employee_name) like '%'||lower(#searchName#)||'%'
			</isNotEmpty>
		</dynamic> 

			ORDER BY 
				employee_id
	</select>

	<select id = "getDepartmentName" resultClass="com.hris.portal.model.PortalDepartmentBean" parameterClass="java.lang.String">
		SELECT
			department_id AS departmentId,
		    department_name AS msDepartmentName,
		    location_id AS locationId
		FROM
		    ms_department
		order by
		    department_id
	</select>
	
	<select id = "getOneEmp" resultClass="com.hris.portal.model.PortalDepartmentBean" parameterClass="java.lang.String">
<!-- 		SELECT -->
<!-- 			employee_id AS employeeId, -->
<!-- 			employee_name AS employeeName -->
<!-- 		FROM -->
<!-- 			ms_employee -->
<!-- 		WHERE  -->
<!-- 			employee_id = #empId# -->
		
		SELECT
<!-- 		    e.employee_id AS employeeId, -->
			e.employee_name AS deptEmployeeName,
		    e.department_id AS departmentId,
		    d.department_name AS msDepartmentName,
		    d.location_id AS locationId
		FROM
		    ms_employee e
		    join ms_department d
		    on d.department_id = e.department_id
		WHERE
			e.employee_id = #empId# 
	</select>

	<select id = "getRoleList" resultClass="com.hris.portal.model.PortalBean" parameterClass="java.lang.String">
		SELECT
		    e.employee_name AS employeeName,
		    r.role_name AS roleName
		FROM
		    ms_employee e
		    join ms_user u 
		    on u.employee_id = e.employee_id
		    join ms_role r 
		    on u.role_id = r.role_id
		ORDER BY 
		    e.employee_id	
	</select>
	
	<select id = "getRoleName" resultClass="com.hris.portal.model.PortalBean" parameterClass="java.lang.String">
		SELECT
			role_id AS roleId,
		    role_name AS roleName
		FROM
		    ms_role
	</select>
	
	<insert id = "insertUser" parameterClass="java.util.Map">
		INSERT INTO
			MS_USER
		VALUES
			((SELECT MAX(user_id) AS MAX_ID FROM MS_USER)+1, #employeeName#, #msDepartmentName#, #empId#, #roleId#, null, SYSDATE, null, null)
	</insert>

</sqlMap>